<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikilokal</title>
    <link rel="icon" href="wikilokal.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #38bdf8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --bg-color: #f9fafb;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --bg-secondary: #f3f4f6;
            --radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --secondary-color: #2563eb;
            --accent-color: #60a5fa;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --text-color: #f9fafb;
            --text-light: #d1d5db;
            --bg-color: #1f2937;
            --card-bg: #374151;
            --border-color: #4b5563;
            --bg-secondary: #2d3748;
        }

        /* ===== FONT UPGRADE ===== */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            letter-spacing: -0.011em;
        }

        h1 {
            font-family: 'Inter', sans-serif;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: 1.75rem;
            text-align: center;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            letter-spacing: -0.025em;
        }

        h2 {
            font-family: 'Inter', sans-serif;
            color: var(--primary-color);
            font-size: 1.4rem;
            margin-bottom: 1rem;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        h3 {
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.025em;
        }

        #controls {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
            display: grid;
            grid-template-columns: repeat(2, auto) 1fr auto;
            gap: 1rem;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        @media (max-width: 968px) {
            #controls {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }

            #check-permission {
                grid-column: 1 / -1;
            }

            .permission-badge {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            #controls {
                grid-template-columns: 1fr;
                padding: 1rem;
                gap: 0.85rem;
            }

            #theme-select,
            #language-select,
            #check-permission,
            .permission-badge {
                width: 100%;
                grid-column: 1;
            }

            #check-permission {
                justify-content: center;
            }

            .permission-badge {
                text-align: center;
            }
        }

        .permission-badge {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .permission-badge.granted {
            background-color: rgba(16, 185, 129, 0.15);
            color: var(--success-color);
        }

        .permission-badge.denied {
            background-color: rgba(239, 68, 68, 0.15);
            color: var(--danger-color);
        }

        .permission-badge.pending {
            background-color: rgba(245, 158, 11, 0.15);
            color: var(--warning-color);
        }

        #article-count {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 400;
        }

        .progress-container {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .progress-text {
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 100px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 100px;
            transition: width 0.3s ease;
        }

        .progress-count {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        #theme-select,
        #language-select {
            padding: 0.75rem 1rem;
            padding-right: 2.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            font-family: inherit;
            font-size: 0.9375rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        #theme-select {
            min-width: 140px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M2 4l4 4 4-4z'/%3E%3C/svg%3E");
        }

        #language-select {
            min-width: 210px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M2 4l4 4 4-4z'/%3E%3C/svg%3E");
        }

        #theme-select:hover,
        #language-select:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #theme-select:focus,
        #language-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        [data-theme="dark"] #theme-select,
        [data-theme="dark"] #language-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23d1d5db' d='M2 4l4 4 4-4z'/%3E%3C/svg%3E");
        }

        #theme-select option,
        #language-select option {
            padding: 0.5rem;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        button {
            padding: 0.65rem 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #check-permission::before {
            content: "üìç";
            font-size: 1rem;
        }

        #location-status {
            margin-bottom: 1.5rem;
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow);
        }

        .coordinates-display {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary-color);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .coordinates-display::before {
            content: "üìç";
            font-size: 1.2rem;
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            cursor: pointer;
            user-select: none;
            padding: 0.75rem;
            border-radius: var(--radius);
            transition: background-color 0.2s;
            background-color: var(--bg-secondary);
        }

        .location-header:hover {
            background-color: var(--border-color);
        }

        .location-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        .toggle-icon {
            font-size: 1rem;
            transition: transform 0.3s ease;
            color: var(--text-light);
            font-weight: bold;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .location-details {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .location-details.hidden {
            max-height: 0;
            opacity: 0;
        }

        .location-part {
            margin: 0.75rem 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem;
            background-color: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .location-part span {
            font-weight: 500;
            margin-right: auto;
        }

        /* === REVAMPED ACTION BUTTONS === */
        .location-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.35rem 0.75rem;
            font-size: 0.85rem;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .location-action-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .location-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        [data-theme="dark"] .location-action-btn {
            background-color: var(--card-bg);
        }

        #results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.25rem;
            padding: 0;
            list-style: none;
        }

        @media (min-width: 769px) and (max-width: 1200px) {
            #results {
                grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            }
        }

        @media (min-width: 1201px) {
            #results {
                grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            }
        }

        @media (max-width: 768px) {
            #results {
                grid-template-columns: 1fr;
            }
        }

        .article-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            max-width: 100%;
            margin: 0;
        }

        .article-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
            border-color: var(--primary-color);
        }

        .article-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-right: 1px solid var(--border-color);
        }

        .article-content {
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .article-card a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            display: block;
            transition: color 0.2s;
        }

        .article-card a:hover {
            color: var(--secondary-color);
        }

        .language-badge {
            display: inline-flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            background: transparent;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            width: fit-content;
            margin: 0;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .language-badge:hover {
            background: var(--primary-color);
            color: white;
        }

        .description {
            font-size: 0.9rem;
            color: var(--text-color);
            line-height: 1.5;
            margin-bottom: 0.5rem;
            overflow: visible;
            text-overflow: clip;
        }

        .description.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .description.expanded {
            display: block;
        }

        .description-toggle {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.35rem 0.75rem;
            background-color: var(--bg-secondary);
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            border-radius: 100px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .description-toggle:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .details-section.collapsed {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
            margin: 0;
        }

        .details-section.expanded {
            max-height: 2000px;
            opacity: 1;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
            margin-top: 0.5rem;
        }

        .distance {
            display: inline-flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            background: transparent;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            width: fit-content;
            margin: 0;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .distance:hover {
            background: var(--primary-color);
            color: white;
        }

        .distance::before {
            content: "üìç";
            margin-right: 0.35rem;
            font-size: 0.9rem;
        }

        .title-badges-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .title-wrapper {
            flex: 1;
            min-width: 200px;
        }

        .badges-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .title-badges-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .badges-wrapper {
                width: 100%;
                justify-content: flex-start;
            }

            .article-card {
                flex-direction: column;
            }

            .article-card img {
                width: 100%;
                height: 180px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
        }

        .wikidata {
            font-size: 0.85rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0;
            flex-wrap: wrap;
            margin-bottom: 0.25rem;
        }

        .wikidata a {
            font-size: 0.85rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .wikidata a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        .wiktionary {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
        }

        .wiktionary span {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .wiktionary button {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.35rem 0.85rem;
            font-size: 0.85rem;
            border-radius: 100px;
            transition: background-color 0.2s, color 0.2s;
        }

        .wiktionary button:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .card-actions {
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .route-btn {
            background-color: var(--accent-color);
            flex: 1;
        }

        .route-btn::before {
            content: "üó∫Ô∏è";
            margin-right: 0.5rem;
        }

        .google-maps-btn {
            background-color: #34c759;
            flex: 1;
        }

        .google-maps-btn::before {
            content: "üåç";
            margin-right: 0.5rem;
        }

        .loading,
        .error {
            text-align: center;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .loading {
            color: var(--text-light);
            animation: pulse 1.5s infinite;
        }

        .error {
            color: var(--danger-color);
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        .map-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            max-width: 90%;
            max-height: 90%;
            display: flex;
            flex-direction: column;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: var(--primary-color);
            color: white;
        }

        .popup-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .close-btn {
            background: none;
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 0.5rem;
            margin: 0;
        }

        .close-btn:hover {
            opacity: 0.8;
        }

        .map-container {
            width: 80vw;
            max-width: 800px;
            height: 60vh;
            max-height: 600px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            backdrop-filter: blur(2px);
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .article-card {
                flex-direction: column;
            }

            .article-card img {
                width: 100%;
                height: 180px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .article-content {
                padding: 1.5rem;
            }

            .map-container {
                width: 90vw;
                height: 50vh;
            }
        }

        .map-popup .leaflet-popup-content-wrapper,
        .map-popup .leaflet-popup-tip,
        .map-popup .leaflet-routing-container,
        .map-popup .leaflet-control {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
        }

        .map-popup .leaflet-popup-content {
            color: var(--text-color) !important;
        }

        .map-popup .leaflet-popup-close-button {
            color: white !important;
            font-weight: bold;
        }

        .map-popup .leaflet-popup-close-button:hover {
            color: #ff5f5f !important;
        }

        .map-popup .leaflet-routing-icon {
            filter: invert(1) hue-rotate(180deg);
        }

        @media (prefers-color-scheme: dark) {
            .map-popup .leaflet-routing-icon {
                filter: invert(0);
            }
        }

        .map-popup .leaflet-popup-content-wrapper a,
        .map-popup .leaflet-popup-content a {
            color: var(--primary-color) !important;
        }

        .map-popup .leaflet-popup-content-wrapper a:hover,
        .map-popup .leaflet-popup-content a:hover {
            color: var(--accent-color) !important;
        }

        .map-popup .leaflet-routing-alt {
            background: var(--bg-secondary) !important;
            color: var(--text-color) !important;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            flex-wrap: wrap;
            gap: 1rem;
            border: 1px solid var(--border-color);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            min-width: 250px;
        }

        .wiki-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #F8F7F3, #FFF);
            background-image: url('wikilokal.png');
            background-size: 80%;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 12px;
            display: block;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .header-title {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            align-items: flex-start;
        }

        .header-title h1 {
            margin: 0;
            border: none;
            padding: 0;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .header-title p {
            font-size: 0.875rem;
            color: var(--text-light);
            line-height: 1.6;
        }

        .header-right {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-end;
        }

        .header-right button {
            padding: 0.65rem 1rem;
            font-size: 0.9rem;
            white-space: nowrap;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #guide-btn {
            background-color: var(--bg-secondary);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        #guide-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        #wikigaleri-btn {
            background-color: var(--bg-secondary);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        #wikigaleri-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        #creator-btn {
            background-color: var(--bg-secondary);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        #creator-btn:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
            animation: fadeIn 0.3s ease-in;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.25s ease;
            color: var(--text-color);
            padding: 0;
            margin: 0;
            line-height: 1;
        }

        .modal-close:hover {
            opacity: 0.7;
        }

        .guide-section {
            margin-bottom: 1.5rem;
        }

        .guide-section h3 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.1rem;
        }

        .guide-section p {
            margin: 0.5rem 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .guide-section ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .guide-section li {
            margin: 0.25rem 0;
            font-size: 0.95rem;
        }

        #scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 100;
            padding: 0;
        }

        #scroll-to-top:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        #scroll-to-top.show {
            display: flex;
        }

        .wiktionary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
            background-color: var(--bg-secondary);
        }

        .wiktionary-header:hover {
            background-color: var(--border-color);
        }

        .wiktionary-header span {
            font-size: 0.85rem;
            color: var(--text-color);
            font-weight: 600;
        }

        .wiktionary-toggle {
            font-size: 0.8rem;
            color: var(--text-light);
            transition: transform 0.3s ease;
        }

        .wiktionary-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .wiktionary-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: var(--bg-secondary);
            border-radius: 4px;
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease, margin 0.3s ease;
            opacity: 1;
        }

        .wiktionary-buttons.hidden {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            padding: 0;
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .empty-state::before {
            content: "üìç";
            font-size: 4rem;
            display: block;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .two-column-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            align-items: start;
        }

        #control-section,
        #location-section {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #control-section h2,
        #location-section h2 {
            margin-bottom: 1rem;
            min-height: 2rem;
        }

        @media (max-width: 968px) {
            .two-column-container {
                grid-template-columns: 1fr;
            }

            #location-status {
                min-height: auto;
            }
        }

        .wikilokal-spinner {
            display: inline-block;
            width: 3.5em;
            height: 3.5em;
            background-color: white;
            border-radius: 50%;
            background-image: url('wikilokal.png');
            background-size: 70%;
            background-position: center;
            background-repeat: no-repeat;
            animation: spin 1.5s linear infinite;
            vertical-align: middle;
            margin-right: 0.35em;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }


        [data-theme="dark"] .wikilokal-spinner {
            background-color: #f0f0f0;
        }

        .commons-icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            padding: 0;
            border-radius: 6px;
            border: 2px solid var(--primary-color);
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .commons-icon-btn:hover {
            background: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        .commons-icon-btn img {
            width: 18px;
            height: 18px;
            transition: filter 0.2s ease;
        }

        .commons-icon-btn:hover img {
            filter: brightness(0) invert(1);
        }

        #playstore-btn {
            background-color: #01875f;
            color: white;
            border: 1px solid #01875f;
        }

        #playstore-btn:hover {
            background-color: #006b4a;
            border-color: #00593d;
            transform: translateY(-1px);
        }

        #playstore-btn i {
            font-size: 1.1em;
            margin-right: 0.35em;
        }

        /* Responsive: pastikan icon tetap terlihat di mobile */
        @media (max-width: 768px) {
            #playstore-btn {
                font-size: 0.85rem;
                padding: 0.6rem 0.85rem;
            }
        }

        /* Perbaikan khusus untuk #controls */
        #controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            /* sedikit lebih longgar */
            align-content: start;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        /* Membuat tombol action lebih menonjol */
        .action-group {
            grid-column: 1 / -1;
            /* memenuhi 2 kolom */
            margin-top: 0.5rem;
        }

        .action-group button {
            width: 100%;
            justify-content: center;
            font-size: 1.05rem;
            padding: 0.85rem 1.5rem;
            box-shadow: var(--shadow-md);
        }

        /* Status lebih compact & terlihat jelas */
        .status-group {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            /* rata bawah agar sejajar dengan tombol */
        }

        @media (max-width: 968px) {
            #controls {
                grid-template-columns: 1fr;
                gap: 1.25rem;
            }

            .action-group {
                grid-column: auto;
                margin-top: 1rem;
            }

            .status-group {
                margin-top: 0.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="header-top">
        <div class="header-left">
            <div class="wiki-logo"></div>
            <div class="header-title">
                <h1>Wikilokal</h1>
                <p id="main-subtitle">Explore<img src="images/ic_wikimedia.svg" alt="Wikimedia"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wikimedia
                    projects
                    <br />
                    (<img src="images/ic_wikipedia.svg" alt="Wikipedia"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wikipedia,
                    <img src="images/ic_wikidata.svg" alt="Wikidata"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wikidata,
                    <img src="images/ic_wikivoyage.svg" alt="Wikivoyage"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wikivoyage,
                    <img src="images/ic_wiktionary.svg" alt="Wiktionary"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wiktionary,
                    <img src="images/ic_nominatim.svg" alt="Nominatim"
                        style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Nominatim and
                    OSM)
                    within a 3 km radius of your location.
                </p>
            </div>
        </div>
        <div class="header-right">
            <button id="guide-btn" title="Lihat panduan">üìñ Guide</button>
            <button id="wikigaleri-btn" onclick="window.location.href='../wikigaleri'" title="Kunjungi Affandy Murad">
                <img src="images/ic_commons.svg" alt="Wikigaleri"
                    style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em;"> Wikigaleri
            </button>
            <!-- ===== NEW: Google Play Store Button (Without Font Awesome) ===== -->
            <button id="playstore-btn"
                onclick="window.open('https://play.google.com/store/apps/details?id=kmt.commuterline.am', '_blank')"
                title="Download Wikilokal for Android">
                <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 24 24"
                    fill="currentColor" style="vertical-align: middle; margin-right: 0.35em;">
                    <path
                        d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.16,10.81C20.5,11.08 20.75,11.5 20.75,12C20.75,12.5 20.5,12.92 20.16,13.19L17.89,14.5L15.39,12L17.89,9.5L20.16,10.81M6.05,2.66L16.81,8.88L14.54,11.15L6.05,2.66Z" />
                </svg>
                Wikilokal for Android
            </button>
            <button id="creator-btn" onclick="window.location.href='../'" title="Kembali ke Affandy Murad">
                üè† Back to Affandy Murad
            </button>
        </div>
    </div>
    <div class="two-column-container">
        <section id="control-section" aria-label="Pengaturan">
            <h2>Settings</h2>
            <div id="controls">
                <div class="control-group">
                    <label class="control-label">Theme</label>
                    <select id="theme-select">
                        <option value="light">‚òÄÔ∏è Light</option>
                        <option value="dark">üåô Dark</option>
                        <option value="system">üñ•Ô∏è System</option>
                    </select>
                </div>
                <div class="control-group">
                    <label class="control-label">Wikimedia Project Language</label>
                    <select id="language-select">
                        <option value="id">Indonesian (ID)</option>
                        <option value="en">English (EN)</option>
                        <option value="ms">Malay (MS)</option>
                        <option value="fr">French (FR)</option>
                        <option value="zh">Mandarin (ZH)</option>
                        <option value="es">Spanish (ES)</option>
                        <option value="bew">Betawi (BEW)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label class="control-label">Action</label>
                    <button id="check-permission">Check Location & Search</button>
                </div>
                <div class="control-group">
                    <label class="control-label">Permission Status</label>
                    <span id="permission-status" class="permission-badge">Not checked yet</span>
                </div>
            </div>
        </section>
        <section id="location-section" aria-label="Status Lokasi">
            <h2>Location Status</h2>
            <div id="location-status">
                <div class="coordinates-display"></div>
                <div class="location-header" onclick="toggleLocationDetails()">
                    <h3><img src="images/ic_nominatim.svg" alt="Nominatim"
                            style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-left: 0.35em; margin-bottom: 0.35em;">
                        Location Details</h3>
                    <span class="toggle-icon collapsed">‚ñ∂</span>
                </div>
                <div class="location-details hidden" id="location-details-content"></div>
            </div>
        </section>
    </div>
    <section id="results-section" aria-label="Hasil Pencarian">
        <h2>Search Results<span id="article-count"></span></h2>
        <ul id="results"></ul>
    </section>
    <div id="guide-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="guide-title">üìñ User Guide</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="guide-section" data-section="disclaimer">
                <h3 id="guide-disclaimer-title">‚ö†Ô∏è Location Usage Disclaimer</h3>
                <p id="guide-disclaimer-how"><strong id="guide-disclaimer-how-title">How Wikilokal Uses Your
                        Location:</strong></p>
                <p id="guide-disclaimer-how-desc">
                    Wikilokal only <strong>temporarily</strong> uses your location coordinates to find geotagged
                    Wikipedia, Wikivoyage,
                    and Wiktionary articles near you. Your location data is <strong>not stored</strong> or
                    <strong>shared</strong> with
                    any third party.
                </p>
                <br />
                <p id="guide-disclaimer-warning-title"><strong>‚ö†Ô∏è Important Warning:</strong></p>
                <p id="guide-disclaimer-warning-desc">Be cautious when taking screenshots or photos of your screen. Your
                    full address may be visible and could reveal your current location.</p>
                <p id="guide-disclaimer-use-title"><strong id="guide-disclaimer-use-strong">Only use this feature
                        when:</strong></p>
                <ul>
                    <li id="guide-disclaimer-use-safe">You are in a safe location</li>
                    <li id="guide-disclaimer-use-conducive">Conditions allow you to share your location</li>
                </ul>
                <br />
                <p id="guide-disclaimer-privacy-title"><strong>üîí Your Privacy:</strong></p>
                <ul>
                    <li id="guide-disclaimer-privacy-law">Complies with applicable privacy laws and regulations</li>
                    <li id="guide-disclaimer-privacy-temp">Uses location data only for article search purposes</li>
                    <li id="guide-disclaimer-privacy-no-save">Does not store your location history</li>
                </ul>
            </div>
            <br />
            <div class="guide-section" data-section="features">
                <h3 id="guide-features-title">üéØ Key Features</h3>
                <ul>
                    <li>
                        <strong id="guide-search-title">Search Articles:</strong>
                        <span id="guide-search-desc">Click the button to find Wikipedia articles near your location (3
                            km radius)</span>
                    </li>
                    <li>
                        <strong id="guide-route-title">Route:</strong>
                        <span id="guide-route-desc">View directions to article locations using Leaflet Routing</span>
                    </li>
                    <li>
                        <strong id="guide-wikt-title">Wiktionary:</strong>
                        <span id="guide-wikt-desc">Click words in the description to look up definitions</span>
                    </li>
                </ul>
            </div>
            <div class="guide-section" data-section="settings">
                <h3 id="guide-settings-title">üåç Settings</h3>
                <ul>
                    <li>
                        <strong id="guide-theme-title">Theme:</strong>
                        <span id="guide-theme-desc">Choose Light, Dark, or follow system preference</span>
                    </li>
                    <li>
                        <strong id="guide-lang-title">Language:</strong>
                        <span id="guide-lang-desc">Change language to display content in your preferred language on
                            Wikimedia projects</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <button id="scroll-to-top" title="Kembali ke atas" aria-label="Scroll to top">‚Üë</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script>
        const themeSelect = document.getElementById('theme-select');
        const languageSelect = document.getElementById('language-select');
        const checkPermissionBtn = document.getElementById('check-permission');
        const permissionStatus = document.getElementById('permission-status');
        const articleCount = document.getElementById('article-count');
        const resultsList = document.getElementById('results');
        let currentLang = 'id'; // Default to English
        let currentPosition = null;
        const placeholderImage = 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Placeholder_view_vector.svg/1362px-Placeholder_view_vector.svg.png?20220519031949';

        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

        // Fungsi helper untuk membuka link dengan aman di Safari
        function safeOpenLink(url) {
            if (isSafari) {
                // Untuk Safari, buka di tab yang sama dengan konfirmasi
                if (confirm(`Open this link?\n${url}`)) {
                    window.location.href = url;
                }
            } else {
                window.open(url, '_blank');
            }
        }

        function setTheme(theme) {
            if (theme === 'system') {
                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', systemTheme);
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            localStorage.setItem('theme', theme);
        }

        const savedTheme = localStorage.getItem('theme') || 'system';
        themeSelect.value = savedTheme;
        setTheme(savedTheme);

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (themeSelect.value === 'system') {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });

        themeSelect.addEventListener('change', () => setTheme(themeSelect.value));

        function updatePermissionStatus(state) {
            permissionStatus.className = 'permission-badge';
            if (currentPosition) {
                permissionStatus.textContent = '‚úì Granted';
                permissionStatus.classList.add('granted');
                return;
            }
            if (state === 'granted') {
                permissionStatus.textContent = '‚úì Granted';
                permissionStatus.classList.add('granted');
            } else if (state === 'denied') {
                permissionStatus.textContent = '‚úó Denied';
                permissionStatus.classList.add('denied');
            } else if (state === 'prompt') {
                permissionStatus.textContent = '? Pending';
                permissionStatus.classList.add('pending');
            } else {
                permissionStatus.textContent = 'Not checked yet';
                permissionStatus.classList.add('pending');
            }
        }

        async function checkLocationPermission() {
            if (!navigator.permissions || !navigator.geolocation) {
                updatePermissionStatus('denied');
                return 'denied';
            }
            try {
                const result = await navigator.permissions.query({ name: 'geolocation' });
                updatePermissionStatus(result.state);
                result.onchange = () => {
                    updatePermissionStatus(result.state);
                    if (result.state !== 'granted') {
                        currentPosition = null;
                    }
                };
                return result.state;
            } catch (error) {
                console.error('Error checking permission:', error);
                updatePermissionStatus('denied');
                return 'denied';
            }
        }

        function toggleLocationDetails() {
            const detailsContent = document.getElementById('location-details-content');
            const toggleIcon = document.querySelector('.toggle-icon');
            detailsContent.classList.toggle('hidden');
            toggleIcon.classList.toggle('collapsed');
            toggleIcon.textContent = detailsContent.classList.contains('hidden') ? '‚ñ∂' : '‚ñº';
        }

        async function getLocationDetails(lat, lon) {
            try {
                const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;
                const nominatimResponse = await fetch(nominatimUrl, {
                    headers: { 'User-Agent': 'WikiLokal/1.0', 'Accept-Language': currentLang }
                });
                const data = await nominatimResponse.json();
                if (!data.address) return [{ name: 'Location unknown', wikidataId: null }];
                const { road, postcode, city, state, country, suburb, town, village } = data.address;
                const locationParts = [
                    { name: road, type: 'road' },
                    { name: postcode, type: 'postcode' },
                    { name: suburb, type: 'suburb' },
                    { name: town, type: 'town' },
                    { name: village, type: 'village' },
                    { name: city, type: 'city' },
                    { name: state, type: 'state' },
                    { name: country, type: 'country' }
                ].filter(part => part.name);

                function isGeoDescription(desc) {
                    if (!desc) return false;
                    const d = desc.toLowerCase();
                    return (
                        d.includes("subdistrict") ||
                        d.includes("urban village") ||
                        d.includes("district") ||
                        d.includes("administrative") ||
                        d.includes("city") ||
                        d.includes("town") ||
                        d.includes("village") ||
                        d.includes("municipality") ||
                        d.includes("settlement")
                    );
                }

                function matchEntityByType(entity, type) {
                    if (!entity?.description) return false;
                    const desc = entity.description.toLowerCase();
                    const typeKeywords = {
                        suburb: ["subdistrict", "urban village", "district"],
                        town: ["town", "city", "settlement"],
                        village: ["village", "urban village"],
                        city: ["city", "municipality"],
                        state: ["state", "province", "region"],
                        country: ["country", "nation"]
                    };
                    return typeKeywords[type]?.some(k => desc.includes(k)) || false;
                }

                async function findBestWikidataMatch(name, type) {
                    const url = `https://www.wikidata.org/w/api.php?action=wbsearchentities&search=${encodeURIComponent(name)}&format=json&language=${currentLang}&type=item&origin=*`;
                    const response = await fetch(url);
                    const data = await response.json();
                    const results = data.search || [];
                    if (!results.length) return null;
                    const typeMatched = results.find(r => matchEntityByType(r, type));
                    if (typeMatched) return typeMatched;
                    const exactGeo = results.find(r =>
                        r.label?.toLowerCase() === name.toLowerCase() &&
                        isGeoDescription(r.description)
                    );
                    if (exactGeo) return exactGeo;
                    const geoEntity = results.find(r => isGeoDescription(r.description));
                    if (geoEntity) return geoEntity;
                    const exact = results.find(r => r.label?.toLowerCase() === name.toLowerCase());
                    if (exact) return exact;
                    const nonGeoBlacklist = ["month", "family name", "given name"];
                    const safeFirst = results.find(r => !nonGeoBlacklist.includes((r.description || "").toLowerCase()));
                    if (safeFirst) return safeFirst;
                    return results[0];
                }

                const detailedParts = await Promise.all(
                    locationParts.map(async (part) => {
                        if (part.type === 'road' || part.type === 'postcode') {
                            return { ...part, wikidataId: null };
                        }
                        const entity = await findBestWikidataMatch(part.name, part.type);
                        return { ...part, wikidataId: entity?.id ?? null };
                    })
                );
                return detailedParts;
            } catch (error) {
                console.error('Error retrieving location details:', error);
                return [{ name: 'Failed to retrieve location details', wikidataId: null }];
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return (R * c).toFixed(1);
        }

        async function fetchWiktionaryDefinition(title, lang) {
            try {
                const url = `https://${lang}.wiktionary.org/w/api.php?` +
                    `action=query&titles=${encodeURIComponent(title)}&` +
                    `prop=extracts&exintro&explaintext&exsentences=1&format=json&origin=*`;
                const response = await fetch(url);
                const data = await response.json();
                const pages = data.query.pages;
                const page = Object.values(pages)[0];
                return page.extract ? page.extract.trim() : 'Definition not available';
            } catch (error) {
                console.error('Error fetching Wiktionary definition:', error);
                return 'Failed to load definition';
            }
        }

        async function fetchArticleDetails(title, lang) {
            try {
                const wikiUrl = `https://${lang}.wikipedia.org/w/api.php?` +
                    `action=query&titles=${encodeURIComponent(title)}&` +
                    `prop=extracts|pageimages|pageprops&exintro&explaintext&exsentences=2&` +
                    `pithumbsize=250&format=json&origin=*`;
                const wikiResponse = await fetch(wikiUrl);
                const wikiData = await wikiResponse.json();
                const pages = wikiData.query.pages;
                const page = Object.values(pages)[0];
                const wiktionaryDef = await fetchWiktionaryDefinition(title, lang);
                const wikidataId = page.pageprops?.wikibase_item || null;
                return {
                    description: page.extract || 'Description not available',
                    image: page.thumbnail?.source || placeholderImage,
                    wikidataId: wikidataId,
                    wiktionaryDef: wiktionaryDef
                };
            } catch (error) {
                console.error('Error fetching article details:', error);
                return {
                    description: 'Failed to load description',
                    image: placeholderImage,
                    wikidataId: null,
                    wiktionaryDef: 'Failed to load definition'
                };
            }
        }

        async function fetchNearbyArticles(lat, lon, lang) {
            try {
                resultsList.innerHTML = '<li class="loading">Loading articles...</li>';
                articleCount.textContent = '';
                const radius = 3000;
                const url = `https://${lang}.wikipedia.org/w/api.php?` +
                    `action=query&list=geosearch&gscoord=${lat}|${lon}&` +
                    `gsradius=${radius}&gslimit=50&format=json&origin=*`;
                const response = await fetch(url);
                const data = await response.json();
                return data.query.geosearch;
            } catch (error) {
                resultsList.innerHTML = `<li class="error">Failed to load articles: ${error.message}</li>`;
                articleCount.textContent = '';
                return [];
            }
        }

        async function displayArticles(articles) {
            if (articles.length === 0) {
                resultsList.innerHTML = '<li class="empty-state"><p>No articles found within a 3 km radius</p></li>';
                articleCount.textContent = '(0)';
                return;
            }
            resultsList.innerHTML = `
            <li class="progress-container">
                <div class="wikilokal-spinner"></div>
                <div class="progress-text">Loading article details...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-count" id="progress-count">0 / ${articles.length}</div>
            </li>
        `;
            const progressFill = document.getElementById('progress-fill');
            const progressCount = document.getElementById('progress-count');
            const articleElements = [];

            for (let i = 0; i < articles.length; i++) {
                const article = articles[i];
                const details = await fetchArticleDetails(article.title, currentLang);
                const distance = calculateDistance(
                    currentPosition.coords.latitude,
                    currentPosition.coords.longitude,
                    article.lat,
                    article.lon
                );

                const li = document.createElement('li');
                li.className = 'article-card';
                const img = document.createElement('img');
                img.src = details.image;
                img.alt = article.title;
                img.onerror = () => img.src = placeholderImage;
                li.appendChild(img);

                const contentDiv = document.createElement('div');
                contentDiv.className = 'article-content';

                const titleContainer = document.createElement('div');
                titleContainer.className = 'title-badges-container';
                const titleWrapper = document.createElement('div');
                titleWrapper.className = 'title-wrapper';
                const link = document.createElement('a');
                link.href = `https://${currentLang}.wikipedia.org/wiki/${encodeURIComponent(article.title)}`;
                link.target = '_blank';
                link.style.cssText = 'display:inline-flex; align-items:center; gap:0.4em; font-size:1.2rem; font-weight:700; color:var(--primary-color); text-decoration:none;';
                const iconImg = document.createElement('img');
                iconImg.src = 'images/ic_wikipedia.svg';
                iconImg.style.cssText = 'width:1.3em; height:1.3em;';
                link.appendChild(iconImg);
                link.appendChild(document.createTextNode(article.title));
                link.onmouseover = () => link.style.color = 'var(--secondary-color)';
                link.onmouseout = () => link.style.color = 'var(--primary-color)';
                titleWrapper.appendChild(link);
                titleContainer.appendChild(titleWrapper);

                const badgesWrapper = document.createElement('div');
                badgesWrapper.className = 'badges-wrapper';
                const dist = document.createElement('div');
                dist.className = 'distance';
                dist.textContent = `${distance} km`;
                badgesWrapper.appendChild(dist);
                const langBadge = document.createElement('span');
                langBadge.className = 'language-badge';
                langBadge.textContent = currentLang.toUpperCase();
                badgesWrapper.appendChild(langBadge);

                // ===== Wikimedia Commons Button (Icon Only) =====
                const commonsBtn = document.createElement('button');
                commonsBtn.className = 'commons-icon-btn';
                commonsBtn.title = details.wikidataId
                    ? `Open Wikimedia Commons category for ${article.title}`
                    : `Search "${article.title}" on Wikimedia Commons`;
                commonsBtn.style.cssText = `
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    width: 32px;
                    height: 32px;
                    padding: 0;
                    border-radius: 6px;
                    border: 2px solid var(--primary-color);
                    background: transparent;
                    cursor: pointer;
                    transition: all 0.2s ease;
                `;

                const commonsIcon = document.createElement('img');
                commonsIcon.src = 'images/ic_commons.svg';
                commonsIcon.alt = 'Commons';
                commonsIcon.style.cssText = 'width: 18px; height: 18px;';
                commonsIcon.onerror = function () {
                    // Fallback ke emoji jika icon tidak ditemukan
                    this.style.display = 'none';
                    const emoji = document.createElement('span');
                    emoji.textContent = 'üì∑';
                    emoji.style.fontSize = '16px';
                    this.parentNode.appendChild(emoji);
                };

                commonsBtn.appendChild(commonsIcon);

                // Hover effect
                commonsBtn.onmouseover = () => {
                    commonsBtn.style.background = 'var(--primary-color)';
                    commonsIcon.style.filter = 'brightness(0) invert(1)';
                };
                commonsBtn.onmouseout = () => {
                    commonsBtn.style.background = 'transparent';
                    commonsIcon.style.filter = 'none';
                };

                commonsBtn.onclick = async (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    let targetUrl;
                    if (details.wikidataId) {
                        const directLink = await fetchCommonsCategory(details.wikidataId);
                        targetUrl = directLink || `https://commons.wikimedia.org/w/index.php?search=${encodeURIComponent(article.title)}`;
                    } else {
                        targetUrl = `https://commons.wikimedia.org/w/index.php?search=${encodeURIComponent(article.title)}`;
                    }
                    safeOpenLink(targetUrl);
                };

                badgesWrapper.appendChild(commonsBtn);

                titleContainer.appendChild(badgesWrapper);
                contentDiv.appendChild(titleContainer);

                const desc = document.createElement('div');
                desc.className = 'description collapsed';
                desc.textContent = details.description;
                const detailsSection = document.createElement('div');
                detailsSection.className = 'details-section collapsed';

                const descToggle = document.createElement('button');
                descToggle.className = 'description-toggle';
                descToggle.textContent = 'Read more ‚ñº';
                descToggle.onclick = (e) => {
                    e.stopPropagation();
                    desc.classList.toggle('collapsed');
                    desc.classList.toggle('expanded');
                    detailsSection.classList.toggle('collapsed');
                    detailsSection.classList.toggle('expanded');
                    descToggle.textContent = desc.classList.contains('collapsed') ? 'Read more ‚ñº' : 'Hide ‚ñ≤';
                };
                contentDiv.appendChild(desc);
                contentDiv.appendChild(descToggle);

                const wd = document.createElement('div');
                wd.className = 'wikidata';
                const wdIcon = document.createElement('img');
                wdIcon.src = 'images/ic_wikidata.svg';
                wdIcon.style.cssText = 'width: 1.3em; height: 1.3em; flex-shrink: 0;';
                const wdText = document.createElement('span');
                if (details.wikidataId) {
                    wdText.innerHTML = `Wikidata: <a href="https://www.wikidata.org/wiki/${details.wikidataId}" target="_blank">${details.wikidataId}</a>`;
                } else {
                    wdText.textContent = 'Wikidata: Not available';
                    wdText.style.color = '#888';
                }
                wd.appendChild(wdIcon);
                wd.appendChild(wdText);
                detailsSection.appendChild(wd);

                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'card-actions';
                const routeBtn = document.createElement('button');
                routeBtn.className = 'route-btn';
                routeBtn.textContent = 'Show Route';
                routeBtn.onclick = () => showRoutePopup(
                    currentPosition.coords.latitude,
                    currentPosition.coords.longitude,
                    article.lat,
                    article.lon,
                    article.title
                );
                actionsDiv.appendChild(routeBtn);
                const googleMapsBtn = document.createElement('button');
                googleMapsBtn.className = 'google-maps-btn';
                googleMapsBtn.textContent = 'Open in Google Maps';
                googleMapsBtn.onclick = () => window.open(`https://www.google.com/maps?q=${article.lat},${article.lon}`, '_blank');
                actionsDiv.appendChild(googleMapsBtn);
                detailsSection.appendChild(actionsDiv);

                const wiktDiv = document.createElement('div');
                wiktDiv.className = 'wiktionary';
                const wiktHeader = document.createElement('div');
                wiktHeader.className = 'wiktionary-header';
                const wiktIcon = document.createElement('img');
                wiktIcon.src = 'images/ic_wiktionary.svg';
                wiktIcon.style.cssText = 'width: 1.35em; height: 1.35em; flex-shrink: 0;';
                const wiktTitle = document.createElement('span');
                wiktTitle.textContent = 'Wiktionary';
                const toggleIcon = document.createElement('span');
                toggleIcon.className = 'wiktionary-toggle collapsed';
                toggleIcon.textContent = '‚ñº';
                toggleIcon.style.marginLeft = 'auto';
                wiktHeader.appendChild(wiktIcon);
                wiktHeader.appendChild(wiktTitle);
                wiktHeader.appendChild(toggleIcon);
                wiktDiv.appendChild(wiktHeader);

                const wiktButtons = document.createElement('div');
                wiktButtons.className = 'wiktionary-buttons hidden';
                const textSource = `${article.title} ${details.description}`.toLowerCase();
                const words = textSource
                    .replace(/[^\p{L}\p{N}]+/gu, ' ')
                    .split(/\s+/)
                    .map(w => w.trim())
                    .filter(w => w.length >= 3 && !/^\d+$/.test(w));

                const seen = new Set();
                const uniqueWords = [];
                for (const word of words) {
                    if (!seen.has(word)) {
                        seen.add(word);
                        uniqueWords.push(word);
                    }
                }

                if (uniqueWords.length > 0) {
                    uniqueWords.forEach(word => {
                        const wiktBtn = document.createElement('button');
                        wiktBtn.textContent = word;
                        wiktBtn.title = `Search "${word}" on Wiktionary (${currentLang})`;
                        wiktBtn.onclick = (e) => {
                            e.stopPropagation();
                            window.open(`https://${currentLang}.wiktionary.org/wiki/${encodeURIComponent(word)}`, '_blank');
                        };
                        wiktButtons.appendChild(wiktBtn);
                    });
                } else {
                    const noDef = document.createElement('span');
                    noDef.textContent = 'No words for Wiktionary';
                    noDef.style.color = 'var(--text-light)';
                    noDef.style.fontSize = '0.8rem';
                    wiktButtons.appendChild(noDef);
                }
                wiktDiv.appendChild(wiktButtons);

                wiktHeader.onclick = () => {
                    wiktButtons.classList.toggle('hidden');
                    toggleIcon.classList.toggle('collapsed');
                    toggleIcon.textContent = wiktButtons.classList.contains('hidden') ? '‚ñº' : '‚ñ≤';
                };

                detailsSection.appendChild(wiktDiv);
                contentDiv.appendChild(detailsSection);
                li.appendChild(contentDiv);
                articleElements.push(li);

                const progress = ((i + 1) / articles.length) * 100;
                progressFill.style.width = `${progress}%`;
                progressCount.textContent = `${i + 1} / ${articles.length}`;
            }

            resultsList.innerHTML = '';
            articleElements.forEach(el => resultsList.appendChild(el));
            articleCount.textContent = `(${articles.length})`;
        }

        function showRoutePopup(startLat, startLon, endLat, endLon, title) {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            document.body.appendChild(overlay);
            const popup = document.createElement('div');
            popup.className = 'map-popup';
            const popupHeader = document.createElement('div');
            popupHeader.className = 'popup-header';
            const popupTitle = document.createElement('div');
            popupTitle.className = 'popup-title';
            popupTitle.textContent = `Route to ${title}`;
            popupHeader.appendChild(popupTitle);
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.className = 'close-btn';
            closeBtn.onclick = () => {
                document.body.removeChild(popup);
                document.body.removeChild(overlay);
            };
            popupHeader.appendChild(closeBtn);
            popup.appendChild(popupHeader);
            const mapContainer = document.createElement('div');
            mapContainer.className = 'map-container';
            popup.appendChild(mapContainer);
            document.body.appendChild(popup);
            const map = L.map(mapContainer).setView([startLat, startLon], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19,
                tileSize: 512,
                zoomOffset: -1
            }).addTo(map);
            setTimeout(() => map.invalidateSize(), 100);
            L.marker([startLat, startLon]).addTo(map).bindPopup('Your location');
            L.marker([endLat, endLon]).addTo(map).bindPopup(title);
            L.Routing.control({
                waypoints: [L.latLng(startLat, startLon), L.latLng(endLat, endLon)],
                routeWhileDragging: false,
                show: true,
                lineOptions: { styles: [{ color: 'blue', weight: 4 }] },
                router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),
                fitSelectedRoutes: true,
                showAlternatives: false
            }).addTo(map);
        }

        async function fetchWikivoyageSitelink(qid, lang) {
            try {
                const url = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${qid}&format=json&props=sitelinks&origin=*`;
                const response = await fetch(url);
                const data = await response.json();
                const entity = data.entities[qid];
                const sitelinks = entity?.sitelinks || {};
                const wikivoyageKey = `${lang}wikivoyage`;
                const sitelink = sitelinks[wikivoyageKey]?.title || null;
                return sitelink ? `https://${lang}.wikivoyage.org/wiki/${encodeURIComponent(sitelink)}` : null;
            } catch (error) {
                console.error(`Error fetching Wikivoyage sitelink for ${qid}:`, error);
                return null;
            }
        }

        async function fetchCommonsCategory(qid) {
            try {
                const url = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${qid}&format=json&props=claims&origin=*`;
                const response = await fetch(url);
                const data = await response.json();
                const entity = data.entities[qid];
                const commonsClaim = entity?.claims?.P373;
                if (commonsClaim && commonsClaim.length > 0) {
                    const categoryName = commonsClaim[0].mainsnak.datavalue.value;
                    return `https://commons.wikimedia.org/wiki/Category:${encodeURIComponent(categoryName)}`;
                }
                return null;
            } catch (error) {
                console.error(`Error fetching Commons category for ${qid}:`, error);
                return null;
            }
        }

        async function updateLocationDisplay(lat, lon, locationParts) {
            const coordsDisplay = document.querySelector('.coordinates-display');
            coordsDisplay.textContent = `Coordinates: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
            const detailsContent = document.getElementById('location-details-content');
            detailsContent.innerHTML = '';

            for (const part of locationParts) {
                const div = document.createElement('div');
                div.className = 'location-part';
                const span = document.createElement('span');
                const labels = {
                    'road': 'Street',
                    'postcode': 'Postal Code',
                    'suburb': 'Subdistrict',
                    'city': 'City',
                    'state': 'State',
                    'country': 'Country'
                };
                span.textContent = `${labels[part.type] || part.type}: ${part.name}`;
                div.appendChild(span);

                if (part.type !== 'road' && part.type !== 'postcode') {
                    // ===== Wikidata Button =====
                    const wdBtn = document.createElement('button');
                    wdBtn.className = 'location-action-btn';
                    wdBtn.title = part.wikidataId
                        ? `Open Wikidata entity ${part.wikidataId}`
                        : 'Search on Wikidata (no ID known)';

                    const wdIcon = document.createElement('img');
                    wdIcon.src = 'images/ic_wikidata.svg';
                    wdIcon.alt = 'Wikidata';
                    wdIcon.style.cssText = 'width: 1.1em; height: 1.1em;';

                    const wdLabel = document.createElement('span');
                    wdLabel.textContent = part.wikidataId ? part.wikidataId : 'Wikidata';

                    wdBtn.appendChild(wdIcon);
                    wdBtn.appendChild(wdLabel);

                    if (part.wikidataId) {
                        wdBtn.onclick = () => safeOpenLink(`https://www.wikidata.org/wiki/${part.wikidataId}`);
                    } else {
                        wdBtn.disabled = true;
                        wdBtn.style.opacity = '0.5';
                        wdBtn.style.cursor = 'not-allowed';
                    }
                    div.appendChild(wdBtn);

                    // ===== Wikivoyage Button =====
                    const wvBtn = document.createElement('button');
                    wvBtn.className = 'location-action-btn';
                    wvBtn.title = part.wikidataId
                        ? `Open Wikivoyage page for ${part.name}`
                        : `Search "${part.name}" on Wikivoyage`;

                    const wvIcon = document.createElement('img');
                    wvIcon.src = 'images/ic_wikivoyage.svg';
                    wvIcon.alt = 'Wikivoyage';
                    wvIcon.style.cssText = 'width: 1.1em; height: 1.1em;';

                    const wvLabel = document.createElement('span');
                    wvLabel.textContent = 'Wikivoyage';

                    wvBtn.appendChild(wvIcon);
                    wvBtn.appendChild(wvLabel);

                    wvBtn.onclick = async (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        let targetUrl;
                        if (part.wikidataId) {
                            const directLink = await fetchWikivoyageSitelink(part.wikidataId, currentLang);
                            targetUrl = directLink || `https://${currentLang}.wikivoyage.org/w/index.php?search=${encodeURIComponent(part.name)}`;
                        } else {
                            targetUrl = `https://${currentLang}.wikivoyage.org/w/index.php?search=${encodeURIComponent(part.name)}`;
                        }
                        safeOpenLink(targetUrl);
                    };
                    div.appendChild(wvBtn);

                    // ===== Wikimedia Commons Button =====
                    const commonsBtn = document.createElement('button');
                    commonsBtn.className = 'location-action-btn';
                    commonsBtn.title = part.wikidataId
                        ? `Open Wikimedia Commons category for ${part.name}`
                        : `Search "${part.name}" on Wikimedia Commons`;

                    const commonsIcon = document.createElement('img');
                    commonsIcon.src = 'images/ic_commons.svg';
                    commonsIcon.alt = 'Wikimedia Commons';
                    commonsIcon.style.cssText = 'width: 1.1em; height: 1.1em;';

                    const commonsLabel = document.createElement('span');
                    commonsLabel.textContent = 'Commons';

                    commonsBtn.appendChild(commonsIcon);
                    commonsBtn.appendChild(commonsLabel);

                    commonsBtn.onclick = async (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        let targetUrl;
                        if (part.wikidataId) {
                            const directLink = await fetchCommonsCategory(part.wikidataId);
                            targetUrl = directLink || `https://commons.wikimedia.org/w/index.php?search=${encodeURIComponent(part.name)}`;
                        } else {
                            targetUrl = `https://commons.wikimedia.org/w/index.php?search=${encodeURIComponent(part.name)}`;
                        }
                        safeOpenLink(targetUrl);
                    }
                    div.appendChild(commonsBtn);
                }
                detailsContent.appendChild(div);
            }
        }

        async function getLocation(retryCount = 0, maxRetries = 3) {
            if (!navigator.geolocation) {
                document.querySelector('.coordinates-display').textContent = 'Geolocation not supported';
                document.querySelector('.coordinates-display').style.color = 'var(--danger-color)';
                updatePermissionStatus('denied');
                return;
            }

            const coordsDisplay = document.querySelector('.coordinates-display');
            coordsDisplay.textContent = retryCount === 0
                ? 'Fetching your location...'
                : `Fetching your location... (Attempt ${retryCount + 1}/${maxRetries + 1})`;

            // Timeout yang lebih panjang: 15 detik untuk attempt pertama, 20 detik untuk retry
            const timeout = retryCount === 0 ? 15000 : 20000;

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    currentPosition = position;
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    await checkLocationPermission();
                    const locationParts = await getLocationDetails(lat, lon);
                    await updateLocationDisplay(lat, lon, locationParts);
                    const articles = await fetchNearbyArticles(lat, lon, currentLang);
                    await displayArticles(articles);
                },
                async (error) => {
                    console.error('Geolocation error:', error);

                    // Retry logic untuk TIMEOUT error
                    if (error.code === error.TIMEOUT && retryCount < maxRetries) {
                        coordsDisplay.textContent = `Location timeout, retrying... (${retryCount + 1}/${maxRetries})`;
                        coordsDisplay.style.color = 'var(--warning-color)';

                        // Wait 1 second before retry
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        return getLocation(retryCount + 1, maxRetries);
                    }

                    // Error handling untuk berbagai jenis error
                    let errorMessage = 'Failed to get location: ';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Permission denied. Please allow location access.';
                            updatePermissionStatus('denied');
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location unavailable. Please check your GPS/network.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Request timed out. Please try again or check your connection.';
                            break;
                        default:
                            errorMessage += error.message;
                    }

                    coordsDisplay.textContent = errorMessage;
                    coordsDisplay.style.color = 'var(--danger-color)';

                    // Tampilkan tombol retry manual
                    const detailsContent = document.getElementById('location-details-content');
                    detailsContent.innerHTML = `
                <div style="text-align: center; padding: 1rem;">
                    <button onclick="getLocation(0)" style="background-color: var(--primary-color); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: var(--radius); cursor: pointer; font-weight: 600;">
                        üîÑ Try Again
                    </button>
                </div>
            `;
                },
                {
                    enableHighAccuracy: true,
                    timeout: timeout,
                    maximumAge: 0
                }
            );
        }

        async function searchArticles() {
            const permissionState = await checkLocationPermission();
            if (permissionState === 'denied') {
                alert('Location permission denied. Please allow location access to use this feature.');
                return;
            }
            if (currentPosition) {
                const lat = currentPosition.coords.latitude;
                const lon = currentPosition.coords.longitude;
                const locationParts = await getLocationDetails(lat, lon);
                await updateLocationDisplay(lat, lon, locationParts);
                const articles = await fetchNearbyArticles(lat, lon, currentLang);
                await displayArticles(articles);
            } else {
                await getLocation(0, 3); // Mulai dengan retry count 0, max 3 retries
            }
        }

        languageSelect.addEventListener('change', () => {
            currentLang = languageSelect.value;
            resultsList.innerHTML = '';
            articleCount.textContent = '';
            if (currentPosition) {
                resultsList.innerHTML = `
                <li style="text-align:center; padding:2rem; background:var(--card-bg); border-radius:var(--radius); box-shadow:var(--shadow); color:var(--text-light);">
                    <div style="font-size:2rem; margin-bottom:0.5rem;">Language</div>
                    <strong>Language changed to:</strong><br>
                    <strong style="color:var(--primary-color); font-size:1.1rem;">
                        ${languageSelect.options[languageSelect.selectedIndex].text}
                    </strong><br><br>
                    Click the <strong style="color:var(--accent-color);">"Check Location & Search"</strong> button<br>
                    to display articles in the new language
                </li>
            `;
                permissionStatus.textContent = 'Granted ‚Äî Click to re-search';
                permissionStatus.className = 'permission-badge granted';
            }
        });

        checkPermissionBtn.addEventListener('click', async () => await searchArticles());

        const scrollToTopBtn = document.getElementById('scroll-to-top');
        const locationSection = document.getElementById('location-section');
        window.addEventListener('scroll', () => {
            if (!locationSection) return;
            const locationSectionTop = locationSection.getBoundingClientRect().top;
            scrollToTopBtn.classList.toggle('show', locationSectionTop < 0);
        });
        scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

        window.onload = async () => {
            console.log('WikiLokal ready');
            const permissionState = await checkLocationPermission();
            if (permissionState === 'granted' || currentPosition) {
                updatePermissionStatus('granted');
            }
        };

        document.getElementById('guide-btn').addEventListener('click', () => {
            document.getElementById('guide-modal').classList.add('show');
        });
        function closeGuideModal() {
            document.getElementById('guide-modal').classList.remove('show');
        }
        document.getElementById('guide-modal').addEventListener('click', (e) => {
            if (e.target.id === 'guide-modal') closeGuideModal();
        });
        document.querySelector('.modal-close').addEventListener('click', closeGuideModal);
        window.closeGuideModal = closeGuideModal;
    </script>
</body>

</html>