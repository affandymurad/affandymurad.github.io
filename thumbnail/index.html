<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Info Extractor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        input[type="url"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="url"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .platform-badge {
            display: inline-block;
            padding: 5px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            color: #667eea;
            margin: 20px 0;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .results {
            display: none;
            animation: fadeIn 0.5s;
        }

        .results.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #10b981;
        }

        .thumbnail-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        .thumbnail-url {
            flex: 1;
            padding: 10px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
            color: #667eea;
            word-break: break-all;
        }

        .download-btn {
            padding: 10px 20px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .download-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .small-copy-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .small-copy-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .small-copy-btn.copied {
            background: #10b981;
        }

        .result-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            color: #333;
            font-size: 16px;
            word-break: break-word;
        }

        .result-description {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
            line-height: 1.5;
        }

        .thumbnail {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            border-left: 4px solid #c33;
        }

        .error.active {
            display: block;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            border-left: 4px solid #ffc107;
        }

        .warning.active {
            display: block;
        }

        .examples {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .examples h3 {
            color: #667eea;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .examples ul {
            list-style: none;
            padding: 0;
        }

        .examples li {
            color: #666;
            font-size: 13px;
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .examples li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #667eea;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üåê Social Media Info Extractor</h1>
        <p class="subtitle">Ekstrak informasi dari URL sosial media dan website</p>

        <div class="examples">
            <h3>Platform yang Didukung:</h3>
            <ul>
                <li>Instagram (posts, reels, profiles)</li>
                <li>Facebook (posts, pages)</li>
                <li>X/Twitter (tweets, profiles)</li>
                <li>Threads (posts)</li>
                <li>LinkedIn, TikTok, YouTube</li>
                <li>Blog & Website umum</li>
            </ul>
        </div>

        <div class="input-group">
            <input type="url" id="urlInput" placeholder="Paste URL di sini..." />
            <button id="extractBtn" onclick="extractInfo()">Ekstrak</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Mengambil informasi...</p>
        </div>

        <div class="error" id="error"></div>
        <div class="warning" id="warning"></div>

        <div class="results" id="results">
            <div class="platform-badge" id="platformBadge"></div>

            <div class="result-item">
                <button class="copy-btn" onclick="copyText('siteName')">Salin</button>
                <div class="result-label">Nama Website / Platform</div>
                <div class="result-value" id="siteName">-</div>
            </div>

            <div class="result-item">
                <button class="copy-btn" onclick="copyText('contentTitle')">Salin</button>
                <div class="result-label">Judul Konten</div>
                <div class="result-value" id="contentTitle">-</div>
            </div>

            <div class="result-item" id="descSection">
                <button class="copy-btn" onclick="copyText('description')">Salin</button>
                <div class="result-label">Deskripsi</div>
                <div class="result-description" id="description">-</div>
            </div>

            <div class="result-item" id="authorSection">
                <button class="copy-btn" onclick="copyText('author')">Salin</button>
                <div class="result-label">Author / Creator</div>
                <div class="result-value" id="author">-</div>
            </div>

            <div class="result-item" id="thumbnailSection" style="display: none;">
                <div class="result-label">Thumbnail / Image</div>
                <img class="thumbnail" id="thumbnail" alt="Content thumbnail" />
                <div class="thumbnail-controls">
                    <div class="thumbnail-url" id="thumbnailUrl">-</div>
                    <button class="small-copy-btn" onclick="copyThumbnailUrl()">Salin</button>
                    <button class="download-btn" onclick="downloadThumbnail()">Download</button>
                </div>
            </div>

            <div class="result-item" id="videoSection" style="display: none;">
                <div class="result-label">Video URL</div>
                <div class="thumbnail-controls">
                    <div class="thumbnail-url" id="videoUrl">-</div>
                    <button class="small-copy-btn" onclick="copyVideoUrl()">Salin</button>
                    <button class="download-btn" onclick="openVideoUrl()">Buka</button>
                </div>
            </div>

            <div class="result-item" id="urlSection">
                <button class="copy-btn" onclick="copyText('originalUrl')">Salin</button>
                <div class="result-label">URL Asli</div>
                <div class="result-value" id="originalUrl" style="font-size: 14px; color: #667eea;">-</div>
            </div>
        </div>
    </div>

    <script>
        function detectPlatform(url) {
            const urlLower = url.toLowerCase();
            if (urlLower.includes('instagram.com')) return 'Instagram';
            if (urlLower.includes('facebook.com') || urlLower.includes('fb.com')) return 'Facebook';
            if (urlLower.includes('twitter.com') || urlLower.includes('x.com')) return 'X (Twitter)';
            if (urlLower.includes('threads.net')) return 'Threads';
            if (urlLower.includes('linkedin.com')) return 'LinkedIn';
            if (urlLower.includes('tiktok.com')) return 'TikTok';
            if (urlLower.includes('youtube.com') || urlLower.includes('youtu.be')) return 'YouTube';
            if (urlLower.includes('medium.com')) return 'Medium';
            if (urlLower.includes('reddit.com')) return 'Reddit';
            if (urlLower.includes('pinterest.com')) return 'Pinterest';
            return 'Website';
        }

        function convertToFxTwitter(url) {
            if (url.includes('twitter.com') || url.includes('x.com')) {
                return url.replace('twitter.com', 'fxtwitter.com').replace('x.com', 'fxtwitter.com');
            }
            return url;
        }

        function convertToVxTwitter(url) {
            if (url.includes('twitter.com') || url.includes('x.com')) {
                return url.replace('twitter.com', 'vxtwitter.com').replace('x.com', 'vxtwitter.com');
            }
            return url;
        }

        async function extractInfo() {
            const urlInput = document.getElementById('urlInput');
            const extractBtn = document.getElementById('extractBtn');
            let url = urlInput.value.trim();

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            const warning = document.getElementById('warning');

            results.classList.remove('active');
            error.classList.remove('active');
            warning.classList.remove('active');

            if (!url) {
                showError('Silakan masukkan URL yang valid');
                return;
            }

            let validUrl;
            try {
                validUrl = new URL(url);
            } catch (e) {
                showError('Format URL tidak valid. Pastikan URL lengkap dengan https://');
                return;
            }

            const platform = detectPlatform(url);
            document.getElementById('platformBadge').textContent = platform;

            // Disable button dan input saat loading
            extractBtn.disabled = true;
            extractBtn.textContent = 'Mengekstrak...';
            urlInput.disabled = true;
            loading.classList.add('active');

            try {
                let html;
                let fetchSuccess = false;
                let fetchUrl = url;

                // Special URL conversion for better metadata
                if (platform === 'X (Twitter)') {
                    fetchUrl = convertToFxTwitter(url);
                    console.log('Using fxtwitter:', fetchUrl);
                } else if (platform === 'Threads') {
                    // Threads: Try to get the embed URL which has better metadata
                    console.log('Detected Threads URL, will try multiple approaches');
                }

                // PERBAIKAN: Proxy list dengan handling khusus Threads
                const proxies = [
                    `https://api.allorigins.win/raw?url=${fetchUrl}`,
                    `https://corsproxy.io/?${encodeURIComponent(fetchUrl)}`,
                    `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(fetchUrl)}`,
                    `https://api.allorigins.win/get?url=${encodeURIComponent(fetchUrl)}`
                ];

                // Threads: Tambahkan endpoint embed untuk metadata lebih lengkap
                if (platform === 'Threads') {
                    // Threads embed endpoint sering punya metadata lebih baik
                    const threadId = url.split('/post/')[1]?.split('/')[0] || url.split('/post/')[1];
                    if (threadId) {
                        const embedUrl = `https://www.threads.net/embed/${threadId}`;
                        proxies.unshift(`https://api.allorigins.win/raw?url=${embedUrl}`);
                        console.log('Added Threads embed URL:', embedUrl);
                    }
                }

                if (platform === 'X (Twitter)') {
                    const vxUrl = convertToVxTwitter(url);
                    proxies.push(`https://api.allorigins.win/raw?url=${vxUrl}`);
                }

                // PERBAIKAN: Validasi response lebih ketat
                for (const proxyUrl of proxies) {
                    try {
                        console.log('Trying proxy:', proxyUrl.substring(0, 100));
                        const response = await fetch(proxyUrl);
                        if (response.ok) {
                            // Handle JSON response dari allorigins.win/get
                            if (proxyUrl.includes('allorigins.win/get')) {
                                const json = await response.json();
                                html = json.contents;
                            } else {
                                html = await response.text();
                            }

                            // Validasi response lebih lengkap
                            if (html &&
                                !html.includes('JavaScript is not available') &&
                                !html.includes('Access Denied') &&
                                html.length > 500) {
                                console.log('Success with proxy, HTML length:', html.length);
                                fetchSuccess = true;
                                break;
                            } else {
                                console.log('Invalid response, length:', html?.length);
                            }
                        }
                    } catch (e) {
                        console.log('Proxy failed:', proxyUrl.substring(0, 80), e.message);
                        continue;
                    }
                }

                if (!fetchSuccess) {
                    throw new Error('Unable to fetch URL content');
                }

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const siteName =
                    doc.querySelector('meta[property="og:site_name"]')?.content ||
                    doc.querySelector('meta[name="application-name"]')?.content ||
                    doc.querySelector('meta[name="twitter:site"]')?.content?.replace('@', '') ||
                    platform ||
                    validUrl.hostname.replace('www.', '');

                const contentTitle =
                    doc.querySelector('meta[property="og:title"]')?.content ||
                    doc.querySelector('meta[name="twitter:title"]')?.content ||
                    doc.querySelector('title')?.textContent?.replace(' / X', '').replace(' on X', '') ||
                    doc.querySelector('h1')?.textContent?.trim() ||
                    'Tidak ditemukan';

                const description =
                    doc.querySelector('meta[property="og:description"]')?.content ||
                    doc.querySelector('meta[name="twitter:description"]')?.content ||
                    doc.querySelector('meta[name="description"]')?.content ||
                    doc.querySelector('p')?.textContent?.trim().substring(0, 300) ||
                    'Tidak ada deskripsi';

                const author =
                    doc.querySelector('meta[name="author"]')?.content ||
                    doc.querySelector('meta[property="article:author"]')?.content ||
                    doc.querySelector('meta[name="twitter:creator"]')?.content?.replace('@', '') ||
                    doc.querySelector('[rel="author"]')?.textContent?.trim() ||
                    doc.querySelector('meta[property="twitter:creator"]')?.content?.replace('@', '') ||
                    'Tidak diketahui';

                let thumbnail =
                    doc.querySelector('meta[property="og:image"]')?.content ||
                    doc.querySelector('meta[property="og:image:secure_url"]')?.content ||
                    doc.querySelector('meta[name="twitter:image"]')?.content ||
                    doc.querySelector('meta[name="twitter:image:src"]')?.content ||
                    doc.querySelector('meta[property="twitter:image"]')?.content ||
                    doc.querySelector('link[rel="image_src"]')?.href ||
                    null;

                // Extract video URL
                let videoUrl =
                    doc.querySelector('meta[property="og:video"]')?.content ||
                    doc.querySelector('meta[property="og:video:url"]')?.content ||
                    doc.querySelector('meta[property="og:video:secure_url"]')?.content ||
                    doc.querySelector('meta[name="twitter:player:stream"]')?.content ||
                    doc.querySelector('meta[property="twitter:player:stream"]')?.content ||
                    doc.querySelector('video source')?.src ||
                    doc.querySelector('video')?.src ||
                    null;

                // KHUSUS THREADS: Fallback ke img tags jika meta tidak ada
                if (!thumbnail && platform === 'Threads') {
                    // Cari gambar di dalam HTML dengan berbagai selector
                    const imgSelectors = [
                        'img[src*="cdninstagram"]',  // CDN Instagram untuk Threads
                        'img[src*="fbcdn"]',          // Facebook CDN
                        'article img',                // Gambar dalam artikel
                        'img[alt]',                   // Gambar dengan alt text
                        'img[src*="scontent"]',       // CDN content
                        'img'                         // Fallback ke img pertama
                    ];

                    for (const selector of imgSelectors) {
                        const img = doc.querySelector(selector);
                        if (img && img.src &&
                            !img.src.includes('avatar') &&
                            !img.src.includes('profile') &&
                            !img.src.includes('logo') &&
                            img.width > 200) {  // Filter gambar kecil
                            thumbnail = img.src;
                            console.log('Found Threads image via selector:', selector);
                            break;
                        }
                    }
                }

                if (thumbnail && !thumbnail.startsWith('http')) {
                    thumbnail = new URL(thumbnail, url).href;
                }

                if (videoUrl && !videoUrl.startsWith('http')) {
                    videoUrl = new URL(videoUrl, url).href;
                }

                console.log('Extracted video URL:', videoUrl);

                document.getElementById('siteName').textContent = siteName;
                document.getElementById('contentTitle').textContent = contentTitle;
                document.getElementById('description').textContent = description;
                document.getElementById('author').textContent = author;
                document.getElementById('originalUrl').textContent = url;

                const thumbnailSection = document.getElementById('thumbnailSection');
                const thumbnailImg = document.getElementById('thumbnail');
                const thumbnailUrlDiv = document.getElementById('thumbnailUrl');

                if (thumbnail) {
                    thumbnailImg.src = thumbnail;
                    thumbnailUrlDiv.textContent = thumbnail;
                    thumbnailImg.onerror = () => {
                        thumbnailSection.style.display = 'none';
                    };
                    thumbnailSection.style.display = 'block';
                } else {
                    thumbnailSection.style.display = 'none';
                }

                // Display video section if video URL exists
                const videoSection = document.getElementById('videoSection');
                const videoUrlDiv = document.getElementById('videoUrl');

                if (videoUrl) {
                    videoUrlDiv.textContent = videoUrl;
                    videoSection.style.display = 'block';
                } else {
                    videoSection.style.display = 'none';
                }

                document.getElementById('descSection').style.display =
                    description === 'Tidak ada deskripsi' ? 'none' : 'block';
                document.getElementById('authorSection').style.display =
                    author === 'Tidak diketahui' ? 'none' : 'block';

                loading.classList.remove('active');
                results.classList.add('active');

                // Re-enable button dan input
                extractBtn.disabled = false;
                extractBtn.textContent = 'Ekstrak';
                urlInput.disabled = false;

                if (contentTitle === 'Tidak ditemukan' || thumbnail === null) {
                    showWarning('Beberapa informasi mungkin tidak lengkap. Platform ini membatasi akses untuk scraping.');
                }

            } catch (err) {
                loading.classList.remove('active');

                // Re-enable button dan input saat error
                extractBtn.disabled = false;
                extractBtn.textContent = 'Ekstrak';
                urlInput.disabled = false;

                let errorMsg = 'Gagal mengambil informasi dari URL. ';

                if (platform === 'X (Twitter)') {
                    errorMsg += 'X/Twitter memiliki proteksi yang kuat terhadap scraping. Coba dengan URL dari platform lain atau website publik.';
                } else if (platform === 'Instagram' || platform === 'Facebook') {
                    errorMsg += 'Platform ini memerlukan autentikasi dan memblokir akses eksternal untuk melindungi privasi pengguna.';
                } else {
                    errorMsg += 'Pastikan URL dapat diakses secara publik dan coba lagi.';
                }

                showError(errorMsg);
                console.error(err);
            }
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.add('active');
        }

        function showWarning(message) {
            const warning = document.getElementById('warning');
            warning.textContent = message;
            warning.classList.add('active');
        }

        function copyText(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                // Find the button within the parent
                const button = element.closest('.result-item').querySelector('.copy-btn');
                const originalText = button.textContent;
                button.textContent = '‚úì Tersalin';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Gagal menyalin teks');
            });
        }

        function copyThumbnailUrl() {
            const thumbnailUrl = document.getElementById('thumbnailUrl').textContent;
            const button = document.querySelector('#thumbnailSection .small-copy-btn');

            navigator.clipboard.writeText(thumbnailUrl).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Tersalin';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Gagal menyalin URL gambar');
            });
        }

        function copyVideoUrl() {
            const videoUrl = document.getElementById('videoUrl').textContent;
            const button = document.querySelector('#videoSection .small-copy-btn');

            navigator.clipboard.writeText(videoUrl).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Tersalin';
                button.classList.add('copied');

                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Gagal menyalin URL video');
            });
        }

        function openVideoUrl() {
            const videoUrl = document.getElementById('videoUrl').textContent;
            window.open(videoUrl, '_blank');
        }

        async function downloadThumbnail() {
            const thumbnailUrl = document.getElementById('thumbnailUrl').textContent;
            const button = event.target;
            const originalText = button.textContent;

            try {
                button.textContent = 'Downloading...';
                button.disabled = true;

                // Fetch image via proxy to avoid CORS
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(thumbnailUrl)}`;
                const response = await fetch(proxyUrl);
                const blob = await response.blob();

                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'thumbnail_' + Date.now() + '.jpg';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                button.textContent = '‚úì Downloaded';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 2000);
            } catch (err) {
                console.error('Failed to download:', err);
                alert('Gagal mendownload gambar. Coba klik kanan pada gambar dan pilih "Save Image As"');
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        document.getElementById('urlInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                extractInfo();
            }
        });

        // Auto-extract dari query parameter saat page load
        window.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const urlFromQuery = urlParams.get('url');

            if (urlFromQuery) {
                document.getElementById('urlInput').value = decodeURIComponent(urlFromQuery);
                extractInfo();
            }
        });
    </script>
</body>

</html>